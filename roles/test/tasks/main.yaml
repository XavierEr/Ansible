---
- name: Download test source
  git:
    repo: https://github.com/XavierEr/test.git
    dest: github/test/
    update: yes

- name: Install packages based on package.json.
  npm:
    path: github/test/
    state: present

- name: Install PM2
  npm:
    name: pm2
    global: yes
    production: yes
    state: present

- name: Stop test server
  shell: pm2 stop server
  args:
    chdir: github/test/

- name: Remove test server
  shell: pm2 remove server
  args:
    chdir: github/test/

- name: Run test server
  shell: pm2 start server.js --name server
  args:
    chdir: github/test/
...