---
- name: Download test source
  git:
    repo: https://github.com/XavierEr/test.git
    dest: github/test/
    update: yes

- name: Install packages based on package.json.
  npm:
    path: github/test/
    state: present

- name: Install pm2
  npm:
    name: pm2
    global: yes
    production: yes
    state: present

- name: Delete test from pm2
  shell: pm2 delete test
  args:
    chdir: github/test/
  ignore_errors: yes

- name: Run test server
  shell: pm2 start server.js --name test
  args:
    chdir: github/test/
...